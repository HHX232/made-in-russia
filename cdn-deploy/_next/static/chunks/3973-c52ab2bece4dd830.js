(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3973],{17710:(e,t,a)=>{"use strict";a.d(t,{A:()=>c});var r=a(33284);let s="/products-summary",c={async getAll(){var e,t;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,l=arguments.length>3?arguments[3]:void 0,i={page:null!=(e=a.page)?e:0,size:null!=(t=a.size)?t:10,...a};return c&&0!==c.length?(await (0,r.Ay)({url:c,method:"GET",params:i,headers:{"Accept-Language":n,"x-language":n,Authorization:"Bearer ".concat(l||"")}})).data:(await (0,r.Rh)({url:s,method:"GET",params:i,headers:{"Accept-Language":n,"x-language":n,Authorization:"Bearer ".concat(l||"")}})).data},async getById(e,t){let{data:a}=await (0,r.Rh)({url:"".concat(s,"/").concat(e),method:"GET",headers:{"Accept-Language":t}});return a},async getByIds(e,t){let{data:a}=await (0,r.Rh)({url:"".concat(s,"/ids"),method:"GET",params:{ids:e.join(",")},headers:{"Accept-Language":t}});return a}}},53973:(e,t,a)=>{"use strict";a.d(t,{A:()=>j});var r=a(95155),s=a(12115),c=a(75029),n=a.n(c),l=a(48213),i=a(26715),o=a(95838),d=a(17710),u=a(60584);let g="products",_=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0,r=(0,u.f4)(),[c,n]=(0,s.useState)([]),l=(0,s.useRef)(""),_=(0,i.useQueryClient)(),p={...e};delete p.page;let h=JSON.stringify([p,t]);(0,s.useEffect)(()=>{l.current!==h&&(console.log("Параметры изменились, очищаем данные"),n([]),l.current=h)},[h]);let v=[g,r,h,t,e.page],x=(0,o.useQuery)({queryKey:v,queryFn:async()=>(console.log("Выполняем запрос с параметрами:",e),await d.A.getAll({...e,approveStatuses:"ALL"===e.approveStatuses?"":e.approveStatuses},t,r,a)),placeholderData:e=>null!=e?e:void 0,staleTime:3e4,refetchOnWindowFocus:!1,refetchOnMount:!0});(0,s.useEffect)(()=>{x.data&&(console.log("Получили данные от API:",x.data.content.length,"товаров"),n(t=>{if(!e.page||0===e.page)return console.log("Заменяем данные (первая страница)"),x.data.content;console.log("Добавляем к существующим данным");let a=x.data.content.filter(e=>!t.some(t=>t.id===e.id));return[...t,...a]}))},[x.data,e.page]);let C=async()=>{console.log("Принудительное обновление"),n([]),await _.invalidateQueries({queryKey:[g]}),x.refetch()};return{...x,resData:c,forceRefetch:C}};var p=a(68514),h=a(34540),v=a(94872),x=a(9013),C=a(6874),m=a.n(C),f=a(17652),y=a(71747),S=a(56672);let j=e=>{let{initialProducts:t=[],initialHasMore:a=!0,specialRoute:c,canCreateNewProduct:i=!1,onPreventCardClick:o,extraButtonsBoxClass:d,isForAdmin:u=!1,direction:g="desc",approveStatuses:C="ALL"}=e,j=(0,h.d4)(e=>(0,p.mG)(e,"priceRange")),{selectedFilters:A,delivery:w,searchTitle:P}=(0,v.N)(e=>e.filters),[E,L]=(0,s.useState)(new Set),[N,k]=(0,s.useState)(a),b=(0,s.useRef)(null),I=(0,s.useRef)(null),[F,R]=(0,s.useState)([]),{addToLatestViews:D}=(0,x.d)(),M=(0,y.iD)(),[B,O]=(0,s.useState)({page:0,size:10,minPrice:null==j?void 0:j.min,maxPrice:null==j?void 0:j.max,deliveryMethodIds:(null==w?void 0:w.join(","))?null==w?void 0:w.join(","):"",title:P,sort:"creationDate",direction:g||"asc",approveStatuses:"ALL"===C?"":C}),G=(0,f.c3)("HomePage"),U=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t)L(new Set(e.map(e=>e.id)));else{let t=e.filter(e=>!E.has(e.id));t.length>0&&L(new Set([...E,...t.map(e=>e.id)]))}};(0,s.useEffect)(()=>{t.length>0&&(U(t,!0),O(e=>({...e,page:1})))},[]),(0,s.useEffect)(()=>{R(Object.keys(A).filter(e=>!isNaN(Number(e))).map(Number))},[A]),(0,s.useEffect)(()=>{L(new Set),O(e=>({...e,page:0,title:P}))},[P]),(0,s.useEffect)(()=>{L(new Set),O(e=>{let t={...e,page:0,minPrice:null==j?void 0:j.min,maxPrice:null==j?void 0:j.max,deliveryMethodIds:(null==w?void 0:w.join(","))||""};return F.length>0?t.categoryIds=F.join(","):"categoryIds"in t&&delete t.categoryIds,t})},[F,j,w]),(0,s.useEffect)(()=>{u&&(L(new Set),O(e=>({...e,page:0,approveStatuses:"ALL"===C?"":C})))},[C,u]),(0,s.useEffect)(()=>{u&&(L(new Set),O(e=>({...e,page:0,direction:g})))},[g,u]);let{data:z,isLoading:T,isError:q,isFetching:Q,resData:V}=_(B,c,M||""),H=T&&0===V.length;(0,s.useEffect)(()=>{console.log("resData",V)},[V]),(0,s.useEffect)(()=>{z&&(0===B.page?U(z.content,!0):U(z.content,!1),k(!z.last&&z.content.length>0))},[z]);let K=(0,s.useCallback)(e=>{!H&&(b.current&&b.current.disconnect(),I.current=e,b.current=new IntersectionObserver(e=>{e[0].isIntersecting&&N&&!Q&&O(e=>({...e,page:e.page+1}))}),e&&b.current.observe(e))},[H,N,Q]);return q?(0,r.jsx)("div",{style:{marginBottom:"50px"},children:"Not found"}):(0,r.jsxs)("div",{id:"cy-cards-catalog",className:n().cardsCatalog__box,children:[u&&(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",height:"200px",justifyContent:"space-evenly",background:"white",borderRadius:"20px",padding:"10px 30px"},children:[(0,r.jsx)(S.A,{extraClass:n().dropList__box__extra__index,title:""===B.approveStatuses||"ALL"===B.approveStatuses?"Все":"APPROVED"===B.approveStatuses?"Одобрено":"Ожидает",items:[(0,r.jsx)("p",{onClick:()=>{O(e=>({...e,page:0,approveStatuses:""})),L(new Set)},children:"Все"},"all"),(0,r.jsx)("p",{onClick:()=>{O(e=>({...e,page:0,approveStatuses:"APPROVED"})),L(new Set)},children:"APPROVED"},"approved"),(0,r.jsx)("p",{onClick:()=>{O(e=>({...e,page:0,approveStatuses:"PENDING"})),L(new Set)},children:"PENDING"},"pending")]}),(0,r.jsx)(S.A,{title:"asc"===B.direction?"По возрастанию":"По убыванию",items:[(0,r.jsx)("p",{onClick:()=>{O(e=>({...e,page:0,direction:"desc"})),L(new Set)},children:"С начала"},"desc"),(0,r.jsx)("p",{onClick:()=>{O(e=>({...e,page:0,direction:"asc"})),L(new Set)},children:"С конца"},"asc")]})]}),i&&(0,r.jsx)(m(),{className:"".concat(n().cardsCatalog__create__link),href:"/create-card",children:(0,r.jsxs)("div",{className:"".concat(n().cardsCatalog__create),children:[(0,r.jsx)("div",{className:"".concat(n().cardsCatalog__create__image),children:"+"}),(0,r.jsx)("div",{className:"".concat(n().cardsCatalog__create__text)}),(0,r.jsx)("div",{className:"".concat(n().cardsCatalog__create__text)}),(0,r.jsx)("div",{className:"".concat(n().cardsCatalog__create__text)}),(0,r.jsx)("div",{className:"".concat(n().cardsCatalog__create__button)})]})}),!H&&V.map((e,t)=>{let a="".concat(e.id,"-").concat(t);return t===V.length-1?(0,r.jsx)("div",{style:{height:"100%",width:"100%"},ref:K,children:(0,r.jsx)(l.A,{isForAdmin:u,approveStatus:null==e?void 0:e.approveStatus,extraButtonsBoxClass:d,onPreventCardClick:o,canUpdateProduct:i,isLoading:!1,id:e.id,title:e.title,price:e.originalPrice,discount:e.discount,previewImageUrl:e.previewImageUrl,discountedPrice:e.discountedPrice,deliveryMethod:e.deliveryMethod,fullProduct:e,onClickFunction:()=>{D(e)}})},a):(0,r.jsx)(l.A,{isForAdmin:u,approveStatus:null==e?void 0:e.approveStatus,extraButtonsBoxClass:d,onPreventCardClick:o,canUpdateProduct:i,isLoading:!1,id:e.id,title:e.title,price:e.originalPrice,discount:e.discount,previewImageUrl:e.previewImageUrl,discountedPrice:e.discountedPrice,deliveryMethod:e.deliveryMethod,fullProduct:e,onClickFunction:()=>{D(e)}},a)}),H&&(0,r.jsx)(r.Fragment,{children:[1,2,3,4,5,6,7,8,9,10].map((e,t)=>(0,r.jsx)(l.A,{isLoading:!0,id:e,title:"Загрузка...",price:0,discount:0,previewImageUrl:"",discountedPrice:0,deliveryMethod:"Самовывоз",fullProduct:{}},"skeleton-".concat(t)))}),!H&&0===V.length&&(0,r.jsx)("div",{className:n().cardsCatalog__empty,children:(0,r.jsx)("p",{children:G("noResultsCatalog")})}),u&&(0,r.jsx)("button",{onClick:()=>O(e=>({...e,page:e.page+1})),children:"Показать еще"})]})}},75029:e=>{e.exports={cardsCatalog__box:"CardsCatalog_cardsCatalog__box__qvEZM",dropList__box__extra__index:"CardsCatalog_dropList__box__extra__index__XFmLz",cardsCatalog__create__link:"CardsCatalog_cardsCatalog__create__link__9YF48",cardsCatalog__create:"CardsCatalog_cardsCatalog__create__nAFp0",cardsCatalog__create__image:"CardsCatalog_cardsCatalog__create__image__ALFuE",cardsCatalog__create__text:"CardsCatalog_cardsCatalog__create__text__eHDRa",cardsCatalog__create__button:"CardsCatalog_cardsCatalog__create__button__MFaKF"}}}]);